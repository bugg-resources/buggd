#!/bin/bash -e

# Cycle the SHDNZ input to the PCMD3180 chip to reset it
echo "0" > /sys/class/gpio/export
echo "out" > /sys/class/gpio/gpio0/direction
echo "0" > /sys/class/gpio/gpio0/value
sleep 0.1
echo "1" > /sys/class/gpio/gpio0/value
echo "0" > /sys/class/gpio/unexport
sleep 0.5

# Send the I2C setup commands
i2cset -y 1 0x4c 0x02 0x81
i2cset -y 1 0x4c 0x3C 0x40
i2cset -y 1 0x4c 0x41 0x40
i2cset -y 1 0x4c 0x46 0x40
i2cset -y 1 0x4c 0x4b 0x40
i2cset -y 1 0x4c 0x22 0x41
i2cset -y 1 0x4c 0x23 0x41
i2cset -y 1 0x4c 0x24 0x41
i2cset -y 1 0x4c 0x25 0x41
i2cset -y 1 0x4c 0x2B 0x45
i2cset -y 1 0x4c 0x2C 0x67
i2cset -y 1 0x4c 0x73 0xFF
i2cset -y 1 0x4c 0x74 0xFF
i2cset -y 1 0x4c 0x75 0x60
i2cset -y 1 0x4c 0x3e 0xff  # Set Channel 1 volume to max (27dB)